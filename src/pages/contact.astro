---
import Layout from "../layouts/Layout.astro";
import SectionTitle from "../components/SectionTitle.astro";
import SkewButton from "../components/SkewButton.astro";
---

<Layout title="Contact - Titouan Winkel">
    <main class="container mx-auto px-6 py-16 flex flex-col items-center">
        <div class="w-full max-w-5xl">
            <SectionTitle text="Me contacter" />

            <!-- Contact info at the top -->
            <div
                class="mb-8 flex gap-12 text-lg"
                style="font-family: 'Space Grotesk', sans-serif; font-size: 20px; font-weight: 500;"
            >
                <p>
                    <span class="font-semibold">Mail :</span>
                    <a
                        href="mailto:titouan.winkel@edu.univ-fcomte.fr"
                        class="text-purple-600 hover:text-purple-800 underline"
                    >
                        titouan.winkel@edu.univ-fcomte.fr
                    </a>
                </p>
                <p>
                    <span class="font-semibold">Téléphone :</span>
                    <a
                        href="tel:+33762708634"
                        class="text-purple-600 hover:text-purple-800 underline"
                    >
                        07 62 70 86 34
                    </a>
                </p>
            </div>

            <!-- Contact form -->
            <form id="contact-form" class="space-y-6" method="POST">
                <!-- First row: Prénom and Nom side by side -->
                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <input
                            type="text"
                            name="prenom"
                            placeholder="Prénom"
                            required
                            class="w-full px-6 py-4 bg-purple-200 border-3 border-black"
                            style="font-family: 'Space Grotesk', sans-serif; font-size: 18px;"
                        />
                    </div>
                    <div>
                        <input
                            type="text"
                            name="nom"
                            placeholder="Nom"
                            required
                            class="w-full px-6 py-4 bg-purple-200 border-3 border-black"
                            style="font-family: 'Space Grotesk', sans-serif; font-size: 18px;"
                        />
                    </div>
                </div>

                <!-- Email field -->
                <div>
                    <input
                        type="email"
                        name="email"
                        placeholder="E-mail"
                        required
                        class="w-full px-6 py-4 bg-purple-200 border-3 border-black"
                        style="font-family: 'Space Grotesk', sans-serif; font-size: 18px;"
                    />
                </div>

                <!-- Subject field -->
                <div>
                    <input
                        type="text"
                        name="sujet"
                        placeholder="Sujet"
                        required
                        class="w-full px-6 py-4 bg-purple-200 border-3 border-black"
                        style="font-family: 'Space Grotesk', sans-serif; font-size: 18px;"
                    />
                </div>

                <!-- Message textarea -->
                <div>
                    <textarea
                        name="message"
                        placeholder="Message"
                        required
                        rows="8"
                        class="w-full px-6 py-4 bg-purple-200 border-3 border-black resize-none"
                        style="font-family: 'Space Grotesk', sans-serif; font-size: 18px;"
                    ></textarea>
                </div>

                <!-- Submit button using SkewButton -->
                <div class="flex justify-center pt-4">
                    <SkewButton href="#" text="Envoyer">
                        <button type="submit" class="w-full h-full">
                            Envoyer
                        </button>
                    </SkewButton>
                </div>
            </form>

            <!-- Status message display -->
            <div id="form-status" class="mt-4 text-center hidden"></div>
        </div>
    </main>
</Layout>

<script>
    const form = document.getElementById("contact-form") as HTMLFormElement;
    const statusDiv = document.getElementById("form-status") as HTMLDivElement;

    form.addEventListener("submit", async (e) => {
        e.preventDefault();

        console.log("[v0] Form submitted");

        const formData = new FormData(form);
        const data = {
            prenom: formData.get("prenom"),
            nom: formData.get("nom"),
            email: formData.get("email"),
            sujet: formData.get("sujet"),
            message: formData.get("message"),
        };

        console.log("[v0] Form data:", data);

        statusDiv.classList.remove("hidden");
        statusDiv.textContent = "Envoi en cours...";
        statusDiv.className = "mt-4 text-center text-purple-600";

        try {
            console.log("[v0] Sending request to /api/contact");

            const response = await fetch("/api/contact", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(data),
            });

            console.log("[v0] Response status:", response.status);

            const result = await response.json();
            console.log("[v0] Response data:", result);

            if (response.ok) {
                statusDiv.textContent = "Message envoyé avec succès !";
                statusDiv.className =
                    "mt-4 text-center text-green-600 font-semibold";
                form.reset();
            } else {
                statusDiv.textContent = `Erreur : ${result.error}${result.details ? " - " + result.details : ""}`;
                statusDiv.className =
                    "mt-4 text-center text-red-600 font-semibold";
            }
        } catch (error) {
            console.error("[v0] Fetch error:", error);
            statusDiv.textContent =
                "Erreur lors de l'envoi du message. Veuillez réessayer.";
            statusDiv.className = "mt-4 text-center text-red-600 font-semibold";
        }
    });
</script>
