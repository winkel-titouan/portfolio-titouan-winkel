---
import Layout from "../layouts/Layout.astro";
import CompetencesSection from "../components/SkillsCloud.astro";
import SectionTitle from "../components/SectionTitle.astro";
import SkillsCloud from "../components/SkillsCloud.astro";
import SkewButton from "../components/SkewButton.astro";
import { Image } from "astro:assets";
import heroPC from "../assets/hero-pc.svg";
import personnage from "../assets/a_propos/personnage.svg";
import bubble from "../assets/bubble.svg";
import competencesBg from "../assets/competences-bg.svg";
import spike from "../assets/spike.svg";
import arrow from "../assets/arrow.svg";
import arrowLeft from "../assets/arrow-left.svg";
import download from "../assets/boutons/download.svg";
import lineTop from "../assets/card/line-top.svg";
import lineBot from "../assets/card/line-bot.svg";
import { pb } from "../utils/pb";

let projets = [];
try {
	const records = await pb.collection("projets").getFullList({
		filter: "caroussel = true",
	});
	projets = records;
} catch (error) {
	console.error("Erreur lors de la récupération des projets:", error);
}

function getImageUrl(projet, filename) {
	return `https://portfolio.titouan-winkel.fr/api/files/projets/${projet.id}/${filename}`;
}

function getFirstInspirationImage(projet) {
	if (projet.inspirations && projet.inspirations.length > 0) {
		return getImageUrl(projet, projet.inspirations[0]);
	}
	return "/placeholder.svg?height=300&width=400";
}

function getLogoUrl(projet) {
	if (projet.logo_new) {
		return getImageUrl(projet, projet.logo_new);
	}
	return "/placeholder.svg?height=100&width=100";
}
---

<Layout title="Titouan Winkel - Designer web">
	<!-- Added floating animation keyframes -->
	<style>
		@keyframes float {
			0%,
			100% {
				transform: translateY(0px);
			}
			50% {
				transform: translateY(-20px);
			}
		}

		.floating {
			animation: float 3s ease-in-out infinite;
		}
	</style>

	<!-- Added overflow-x-hidden to prevent horizontal scrolling -->
	<main class="overflow-x-hidden">
		<!-- Redesigned hero section with text and two buttons -->
		<!-- Added flex and items-center to vertically center content, reduced py padding -->
		<!-- Added id="hero-content" and md:block to show only on desktop, hide on mobile when menu is open -->
		<section
			class="relative overflow-hidden flex items-center min-h-[70vh]"
		>
			<div
				id="hero-content"
				class="container mx-auto px-4 md:px-6 z-60 transition-opacity duration-300"
			>
				<div
					class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-12 items-center"
				>
					<div class="space-y-6 md:space-y-8">
						<h1
							class="text-3xl md:text-5xl lg:text-6xl"
							style="font-family: 'Russo One', sans-serif; font-weight: 400; font-style: normal; line-height: 1.2; color: #000;"
						>
							Chaque projet est une nouvelle aventure.
						</h1>

						<div class="flex flex-col gap-4 md:gap-6">
							<SkewButton href="/projets">
								<div class="flex items-center gap-3">
									<Image
										src={arrow || "/placeholder.svg"}
										alt=""
										class="w-5 h-5 md:w-6 md:h-6"
									/>
									<span class="text-sm md:text-base"
										>Découvrir tous mes projets</span
									>
								</div>
							</SkewButton>

							<!-- Updated CV download link to point to actual file in public folder -->
							<SkewButton href="/CV_Titouan_Winkel.pdf" download>
								<div class="flex items-center gap-3">
									<Image
										src={download || "/placeholder.svg"}
										alt=""
										class="w-5 h-5 md:w-6 md:h-6"
									/>
									<span class="text-sm md:text-base"
										>Télécharger mon CV</span
									>
								</div>
							</SkewButton>
						</div>
					</div>

					<!-- Added floating class for animation -->
					<div
						class="flex items-center justify-center min-h-[200px] md:min-h-[300px]"
					>
						<Image
							src={heroPC || "/placeholder.svg"}
							alt="Hero computer illustration"
							class="w-3/4 md:w-full h-auto max-w-full floating"
						/>
					</div>
				</div>
			</div>
		</section>

		<section class="container mx-auto px-4 md:px-6 py-8 md:py-16 md:ml-20">
			<SectionTitle text="Qui suis-je ?" />

			<div
				class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-12 items-start"
			>
				<div
					class="space-y-4 text-base md:text-xl"
					style="font-family: 'Space Grotesk', sans-serif; font-weight: 400; font-style: normal; line-height: normal; color: #000;"
				>
					<p>
						Je m'appelle Titouan <span
							class="text-purple-600 font-semibold">Winkel</span
						>, actuellement étudiant en deuxième année de <span
							class="text-purple-600 font-semibold"
							>BUT Métiers du Multimédia et de l'Internet</span
						>. Passionné par la création visuelle et la
						communication digitale, je me spécialise en design
						graphique. J'aime concevoir des identités visuelles, des
						supports de communication et des interfaces alliant
						créativité et clarté.
					</p>

					<p>
						Curieux et motivé, je cherche à enrichir mes compétences
						à travers des projets concrets, collaboratifs et
						innovants. Mon objectif est de mettre le design au
						service <span class="text-purple-600 font-semibold"
							>d'expériences visuelles cohérentes et impactantes</span
						>.
					</p>
				</div>

				<div class="flex items-center justify-center relative">
					<Image
						src={bubble || "/placeholder.svg"}
						alt=""
						class="absolute -z-10 w-64 md:w-96 h-64 md:h-96 opacity-50"
						style="left: 50%; top: 50%; transform: translate(-50%, -50%);"
					/>
					<Image
						src={personnage || "/placeholder.svg"}
						alt="Personnage illustration"
						class="w-auto h-48 md:h-80 relative z-10"
					/>
				</div>
			</div>
		</section>

		<!-- Redesigned competences section with category names, bars, and no SVG backgrounds -->
		<section class="py-8 md:py-16 overflow-x-hidden">
			<div class="container mx-auto px-4 md:px-6 md:ml-20 mb-15">
				<SectionTitle text="Compétences" />
			</div>

			<!-- Centered category names with single purple bar underneath all categories -->
			<div
				class="container mx-auto px-4 md:px-6 mb-8 flex justify-center"
			>
				<div class="space-y-3">
					<div
						class="flex flex-wrap gap-6 md:gap-12 justify-center items-center"
					>
						<h3
							class="text-xl opacity-75 whitespace-nowrap"
							style="font-family: 'Russo One', sans-serif; font-weight: 400; color: #000;"
						>
							Design
						</h3>

						<h3
							class="text-xl opacity-75 whitespace-nowrap"
							style="font-family: 'Russo One', sans-serif; font-weight: 400; color: #000;"
						>
							Développement web
						</h3>

						<h3
							class="text-xl opacity-75 whitespace-nowrap"
							style="font-family: 'Russo One', sans-serif; font-weight: 400; color: #000;"
						>
							Communication
						</h3>

						<h3
							class="text-xl opacity-75 whitespace-nowrap"
							style="font-family: 'Russo One', sans-serif; font-weight: 400; color: #000;"
						>
							Audiovisuel
						</h3>
					</div>
					<!-- Single purple bar under all categories -->
					<div class="h-1 w-full" style="background-color: #D5B9FF;">
					</div>
				</div>
			</div>

			<!-- Increased gap from gap-6 lg:gap-10 to gap-12 lg:gap-24 -->
			<div
				class="flex flex-col lg:flex-row gap-12 lg:gap-24 items-center justify-center px-4 md:px-6 container mx-auto"
			>
				<div
					class="w-full lg:w-[350px] lg:flex-shrink-0 scale-75 md:scale-100 origin-center md:ml-40"
				>
					<SkillsCloud />
				</div>

				<!-- Added order-first, text-center, mx-auto, and -mt-8 for mobile to center and move description up -->
				<div
					class="w-full lg:w-[350px] lg:flex-shrink-0 lg:order-none text-center lg:text-left mx-auto -mt-8 lg:mt-0"
				>
					<h3
						class="mb-4 text-xl md:text-3xl"
						style="font-family: 'Russo One', sans-serif; font-weight: 400; font-style: normal; line-height: normal; color: #000;"
					>
						Description :
					</h3>
					<p
						id="skill-description"
						class="text-justify leading-relaxed text-sm md:text-xl"
						style="font-family: 'Space Grotesk', sans-serif; font-weight: 400; font-style: normal; color: #000;"
					>
						Cliquez sur une icone
					</p>
				</div>
			</div>
		</section>

		<!-- Redesigned carousel section with project card style -->
		<!-- Modified carousel to disable scroll on desktop and enable free horizontal scroll on mobile -->
		<section class="container mx-auto px-4 md:px-6 py-8 md:py-16">
			<div class="md:ml-8">
				<SectionTitle text="Mes projets" />
			</div>
			<div class="relative mt-8 md:mt-12 flex justify-center">
				<!-- Mobile: enable horizontal scroll with overflow-x-auto, Desktop: hide overflow -->
				<div
					class="carousel-container w-full overflow-x-auto md:overflow-visible scrollbar-hide"
				>
					<div
						class="carousel-track flex gap-4 md:gap-12 md:transition-transform md:duration-500 md:ease-in-out md:justify-center py-4 md:py-8"
					>
						{
							projets.map((projet) => (
								<div class="carousel-item flex-shrink-0 w-64 md:w-70">
									<a
										href={`/projets/${projet.id}`}
										class="block group"
									>
										<div
											class="relative border-3 border-black flex flex-col items-center text-center space-y-4 transition-all duration-300 hover:scale-105 hover:shadow-2xl min-h-[350px]"
											style="background: linear-gradient(353deg, rgba(234, 221, 255, 0.23) 10.66%, #A983E2 67.17%, rgba(234, 221, 255, 0.23) 109.64%);"
										>
											<div class="w-full">
												<img
													src={
														getFirstInspirationImage(
															projet,
														) || "/placeholder.svg"
													}
													alt={projet.nom_projet}
													class="w-full h-48 object-cover"
												/>
											</div>

											<h3
												class="text-black text-xl md:text-2xl px-6"
												style="font-family: 'Russo One', sans-serif;"
											>
												{projet.nom_projet}
											</h3>

											<p
												class="text-black text-xs md:text-sm line-clamp-3 flex-grow px-6 pb-6"
												style="font-family: 'Space Grotesk', sans-serif;"
												set:html={projet.description}
											/>
										</div>
									</a>
								</div>
							))
						}
					</div>
				</div>
			</div>

			<div class="flex md:ml-8 mt-8 md:mt-10">
				<SkewButton href="/projets">
					<div class="flex items-center gap-3">
						<Image
							src={arrow || "/placeholder.svg"}
							alt=""
							class="w-6 h-6"
						/>
						<span class="text-sm md:text-base"
							>Voir tous les projets</span
						>
					</div>
				</SkewButton>
			</div>
		</section>

		<section class="container mx-auto px-4 md:px-4 py-8 md:py-16 md:ml-20">
			<SectionTitle text="Me contacter" />

			<div
				class="flex flex-col md:flex-row justify-between items-start gap-6 md:gap-0 mt-8"
			>
				<div class="space-y-6">
					<p
						class="text-base md:text-xl"
						style="font-family: 'Space Grotesk', sans-serif; font-weight: 400; font-style: normal; line-height: normal; color: #000;"
					>
						Intéressé par mon travail, des questions, une offre
						d'emploi... <span class="text-purple-600 font-semibold"
							>Contacter moi !</span
						>
					</p>
					<div class="md:mt-15">
						<SkewButton href="/contact">
							<div class="flex items-center gap-3">
								<Image
									src={arrow || "/placeholder.svg"}
									alt=""
									class="w-6 h-6"
								/>
								<span class="text-sm md:text-base"
									>Accéder au formulaire</span
								>
							</div>
						</SkewButton>
					</div>
				</div>

				<div class="hidden md:block md:-mt-16 md:mr-25">
					<Image
						src={spike || "/placeholder.svg"}
						alt=""
						class="w-auto h-auto"
					/>
				</div>
			</div>
		</section>
	</main>
</Layout>

<script>
	const skillDescriptions = {
		illustrator:
			"Adobe Illustrator est un logiciel de création graphique vectorielle professionnel, idéal pour la conception de logos, illustrations et designs complexes.",
		figma: "Figma est un outil de design d'interface collaboratif en ligne, parfait pour créer des maquettes web et mobile avec une approche en équipe.",
		css: "CSS (Cascading Style Sheets) est le langage de style qui donne vie aux pages web en définissant leur apparence visuelle et leur mise en page.",
		wordpress:
			"WordPress est un système de gestion de contenu puissant qui permet de créer et gérer facilement des sites web dynamiques sans connaissances techniques approfondies.",
		daisyui:
			"DaisyUI est une bibliothèque de composants pour Tailwind CSS qui propose des éléments d'interface prêts à l'emploi avec un design moderne et cohérent.",
		astro: "Astro est un framework web moderne qui permet de créer des sites ultra-rapides en générant du HTML statique et en chargeant le JavaScript uniquement quand nécessaire.",
		html: "HTML (HyperText Markup Language) est le langage de balisage fondamental qui structure le contenu des pages web et définit leur architecture.",
		javascript:
			"JavaScript est le langage de programmation qui rend les pages web interactives et dynamiques, permettant de créer des expériences utilisateur riches.",
		sql: "SQL (Structured Query Language) est le langage standard pour gérer et interroger les bases de données relationnelles de manière efficace.",
		davinci:
			"DaVinci Resolve est un logiciel de montage vidéo professionnel qui combine édition, étalonnage colorimétrique et effets visuels dans une seule application.",
		capcut: "CapCut est une application de montage vidéo intuitive et accessible, parfaite pour créer du contenu créatif pour les réseaux sociaux rapidement.",
		sketchbook:
			"Sketchbook est une application de dessin numérique intuitive offrant des outils professionnels pour l'illustration et le croquis artistique.",
		notion: "Notion est un espace de travail tout-en-un qui combine prise de notes, gestion de projets et bases de données pour organiser efficacement toutes vos informations.",
		canva: "Canva est une plateforme de design graphique accessible qui permet de créer facilement des visuels professionnels pour les réseaux sociaux et la communication.",
		pocketbase:
			"Pocketbase est une base de données backend légère et open-source qui fournit une API REST automatique et une interface d'administration intégrée.",
		tailwind:
			"Tailwind CSS est un framework CSS utility-first qui permet de construire rapidement des interfaces modernes en composant des classes utilitaires.",
	};

	const descriptionElement = document.getElementById("skill-description");

	document.querySelectorAll("[data-skill]").forEach((button) => {
		button.addEventListener("click", (e) => {
			const skillName = (e.currentTarget as HTMLElement).getAttribute(
				"data-skill",
			);
			if (skillName && descriptionElement) {
				descriptionElement.textContent =
					skillDescriptions[skillName] ||
					"Description non disponible";
			}
		});
	});

	const carouselTrack = document.querySelector(
		".carousel-track",
	) as HTMLElement;
	const carouselContainer = document.querySelector(
		".carousel-container",
	) as HTMLElement;
	const carouselItems = document.querySelectorAll(".carousel-item");

	const isDesktop = window.innerWidth >= 768;

	if (isDesktop) {
		let currentIndex = 0;
		const itemsToShow = 3;
		const itemWidth = 320 + 48; // item width + gap
		const maxIndex = Math.max(0, carouselItems.length - itemsToShow);

		// Drag functionality for desktop only
		let isDragging = false;
		let startPos = 0;
		let currentTranslate = 0;
		let prevTranslate = 0;

		function setPositionByIndex() {
			currentTranslate = -currentIndex * itemWidth;
			prevTranslate = currentTranslate;
			if (carouselTrack) {
				carouselTrack.style.transform = `translateX(${currentTranslate}px)`;
			}
		}

		// Mouse events for desktop
		carouselContainer?.addEventListener("mousedown", (e) => {
			isDragging = true;
			startPos = e.clientX;
			if (carouselContainer) {
				carouselContainer.style.cursor = "grabbing";
			}
			if (carouselTrack) {
				carouselTrack.style.transition = "none";
			}
		});

		carouselContainer?.addEventListener("mousemove", (e) => {
			if (!isDragging) return;
			const currentPosition = e.clientX;
			const diff = currentPosition - startPos;
			currentTranslate = prevTranslate + diff;
			if (carouselTrack) {
				carouselTrack.style.transform = `translateX(${currentTranslate}px)`;
			}
		});

		carouselContainer?.addEventListener("mouseup", (e) => {
			if (!isDragging) return;
			isDragging = false;
			if (carouselContainer) {
				carouselContainer.style.cursor = "grab";
			}
			if (carouselTrack) {
				carouselTrack.style.transition = "transform 0.5s ease-in-out";
			}

			const movedBy = currentTranslate - prevTranslate;
			if (movedBy < -50 && currentIndex < maxIndex) {
				currentIndex += 1;
			} else if (movedBy > 50 && currentIndex > 0) {
				currentIndex -= 1;
			}
			setPositionByIndex();
		});

		carouselContainer?.addEventListener("mouseleave", () => {
			if (isDragging) {
				isDragging = false;
				if (carouselContainer) {
					carouselContainer.style.cursor = "grab";
				}
				if (carouselTrack) {
					carouselTrack.style.transition =
						"transform 0.5s ease-in-out";
				}
				setPositionByIndex();
			}
		});
	}
	// Mobile uses native horizontal scroll, no custom JavaScript needed

	// Hide hero content when mobile menu is open
	window.addEventListener("mobileMenuToggle", (e: CustomEvent) => {
		const heroContent = document.getElementById("hero-content");
		if (heroContent) {
			if (e.detail.isOpen) {
				heroContent.style.opacity = "0";
				heroContent.style.pointerEvents = "none";
			} else {
				heroContent.style.opacity = "1";
				heroContent.style.pointerEvents = "auto";
			}
		}
	});
</script>

<style>
	/* Hide scrollbar on mobile while keeping scroll functionality */
	.scrollbar-hide {
		-ms-overflow-style: none;
		scrollbar-width: none;
	}

	.scrollbar-hide::-webkit-scrollbar {
		display: none;
	}
</style>
