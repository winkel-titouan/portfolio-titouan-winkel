---
import Layout from "../layouts/Layout.astro";
import CompetencesSection from "../components/SkillsCloud.astro";
import SectionTitle from "../components/SectionTitle.astro";
import SkillsCloud from "../components/SkillsCloud.astro";
import SkewButton from "../components/SkewButton.astro";
import { Image } from "astro:assets";
import heroAstro from "../assets/hero-accueil.svg";
import competencesBg from "../assets/competences-bg.svg";
import spike from "../assets/spike.svg";
import arrow from "../assets/arrow.svg";
import heroPC from "../assets/hero-pc.svg";
import personnage from "../assets/a_propos/personnage.svg";
import bubble from "../assets/bubble.svg";
import { pb, type Projet } from "../utils/pb";

let projets: Projet[] = [];
try {
  const records = await pb.collection('projets').getFullList<Projet>();
  projets = records;
} catch (error) {
  console.error('Erreur lors de la récupération des projets:', error);
}

function getImageUrl(projet: Projet, filename: string): string {
  return `https://portfolio.titouan-winkel.fr/api/files/projets/${projet.id}/${filename}`;
}

function getFirstInspirationImage(projet: Projet): string {
  if (projet.inspirations && projet.inspirations.length > 0) {
    return getImageUrl(projet, projet.inspirations[0]);
  }
  return '/placeholder.svg?height=300&width=400';
}

function getLogoUrl(projet: Projet): string {
  if (projet.logo_new) {
    return getImageUrl(projet, projet.logo_new);
  }
  return '/placeholder.svg?height=100&width=100';
}
---

<Layout title="Titouan Winkel - Designer web">
	<main>
		<!-- Hero section directly in index instead of separate component -->
		<section class="container mx-auto px-6 py-16">
			<div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
				<!-- Applied exact Figma dimensions (1193x426px) and shifted SVG left -->
				<div class="text-white p-12 overflow-visible">
					<Image
						src={heroAstro || "/placeholder.svg"}
						alt="Hero background"
						height={400}
						class="absolute top-35 -left-80 -z-10"
					/>
					<!-- Applied exact Figma styles: Russo One, 30px, white -->
					<h2
						class="relative z-10 mb-65"
						style="font-family: 'Russo One', sans-serif; font-size: 30px; font-weight: 400; font-style: normal; line-height: normal; color: #FFF;"
					>
						Chaque projet est une nouvelle aventure.
					</h2>
				</div>

				<!-- Replaced placeholder text with hero-pc.svg image -->
				<div class="flex items-center justify-center min-h-[300px]">
					<Image
						src={heroPC || "/placeholder.svg"}
						alt="Hero computer illustration"
						class="w-auto h-auto max-w-full"
					/>
				</div>
			</div>
		</section>

		<!-- About section directly in index instead of separate component -->
		<section class="container mx-auto px-6 py-16">
			<!-- Using SectionTitle component instead of manual slash + text -->
			<SectionTitle text="Qui suis-je ?" />

			<div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-start">
				<!-- Applied exact Figma styles for body text: Space Grotesk, 20px, weight 400, black -->
				<div
					class="space-y-4"
					style="font-family: 'Space Grotesk', sans-serif; font-size: 20px; font-weight: 400; font-style: normal; line-height: normal; color: #000;"
				>
					<p>
						Je m'appelle Titouan <span
							class="text-purple-600 font-semibold">Winkel</span
						>, actuellement étudiant en deuxième année de <span
							class="text-purple-600 font-semibold"
							>BUT Métiers du Multimédia et de l'Internet</span
						>. Passionné par la création visuelle et la
						communication digitale, je me spécialise en design
						graphique. J'aime concevoir des identités visuelles, des
						supports de communication et des interfaces alliant
						créativité et clarté.
					</p>

					<p>
						Curieux et motivé, je cherche à enrichir mes compétences
						à travers des projets concrets, collaboratifs et
						innovants. Mon objectif est de mettre le design au
						service <span class="text-purple-600 font-semibold"
							>d'expériences visuelles cohérentes et impactantes</span
						>.
					</p>
				</div>

				<!-- Replace placeholder with personnage SVG -->
				<!-- Added relative positioning and bubble decoration behind character -->
				<div class="flex items-center justify-center relative">
					<!-- Decorative bubble behind character -->
					<Image
						src={bubble || "/placeholder.svg"}
						alt=""
						class="absolute -z-10 w-96 h-96 opacity-50"
						style="left: 50%; top: 50%; transform: translate(-50%, -50%);"
					/>
					<Image
						src={personnage || "/placeholder.svg"}
						alt="Personnage illustration"
						class="w-auto h-80 relative z-10"
					/>
				</div>
			</div>
		</section>

		<!-- Competences section directly in index instead of separate component -->
		<section class="py-16">
			<div class="container mx-auto px-6">
				<SectionTitle text="Compétences" />
			</div>

			<!-- Changed to flex with fixed widths to prevent layout shifts -->
			<div class="flex gap-10 items-start mt-5">
				<!-- Added fixed width and flex-shrink-0 to prevent movement -->
				<div class="space-y-4 flex-shrink-0 w-[420px]">
					<div class="relative w-fit">
						<Image
							src={competencesBg || "/placeholder.svg"}
							alt=""
							class="w-auto h-auto"
						/>
						<span
							class="absolute inset-0 flex items-center px-8 text-white text-lg mb-4"
							style="font-family: 'Russo One', sans-serif;"
						>
							Design
						</span>
					</div>
					<div class="relative w-fit">
						<Image
							src={competencesBg || "/placeholder.svg"}
							alt=""
							class="w-auto h-auto"
						/>
						<span
							class="absolute inset-0 flex items-center px-8 text-white text-lg mb-4"
							style="font-family: 'Russo One', sans-serif;"
						>
							Développement web
						</span>
					</div>
					<div class="relative w-fit">
						<Image
							src={competencesBg || "/placeholder.svg"}
							alt=""
							class="w-auto h-auto"
						/>
						<span
							class="absolute inset-0 flex items-center px-8 text-white text-lg mb-4"
							style="font-family: 'Russo One', sans-serif;"
						>
							Communication
						</span>
					</div>
					<div class="relative w-fit">
						<Image
							src={competencesBg || "/placeholder.svg"}
							alt=""
							class="w-auto h-auto"
						/>
						<span
							class="absolute inset-0 flex items-center px-8 text-white text-lg mb-4"
							style="font-family: 'Russo One', sans-serif;"
						>
							Audiovisuel
						</span>
					</div>
				</div>

				<!-- Added flex-shrink-0 to prevent logo cloud from moving -->
				<div class="w-[450px] flex-shrink-0 mt-8">
					<SkillsCloud />
				</div>

				<!-- Reduced width from 400px to 350px -->
				<div class="pt-8 pl-4 w-[350px] flex-shrink-0">
					<h3
						class="mb-4"
						style="font-family: 'Russo One', sans-serif; font-size: 30px; font-weight: 400; font-style: normal; line-height: normal; color: #000;"
					>
						Description :
					</h3>
					<p
						id="skill-description"
						class="text-justify leading-relaxed"
						style="font-family: 'Space Grotesk', sans-serif; font-size: 20px; font-weight: 400; font-style: normal; color: #000;"
					>
						Cliquez sur une icone
					</p>
				</div>
			</div>
		</section>

		<!-- New Projects Carousel Section -->
		<section class="container mx-auto px-6 py-16">
			<SectionTitle text="Mes projets" />
			
			<div class="relative mt-12">
				<!-- Carousel container -->
				<div class="carousel-container overflow-hidden">
					<div class="carousel-track flex gap-8 transition-transform duration-500 ease-in-out">
						{projets.map((projet) => (
							<div class="carousel-item flex-shrink-0 w-80">
								<!-- Project card -->
								<a href={`/projets/${projet.id}`} class="block group">
									<div class="relative bg-white border-4 border-black rounded-lg overflow-hidden hover:shadow-2xl transition-shadow duration-300">
										<!-- Project image -->
										<div class="relative h-48 overflow-hidden">
											<img 
												src={getFirstInspirationImage(projet) || "/placeholder.svg"} 
												alt={projet.nom_projet}
												class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"
											/>
											<!-- Logo overlay -->
											<div class="absolute top-4 left-4 bg-white border-2 border-black rounded-lg p-2">
												<img 
													src={getLogoUrl(projet) || "/placeholder.svg"} 
													alt={`${projet.nom_projet} logo`}
													class="w-12 h-12 object-contain"
												/>
											</div>
										</div>
										
										<!-- Project info -->
										<div class="p-6">
											<h3 
												class="text-xl mb-2"
												style="font-family: 'Russo One', sans-serif;"
											>
												{projet.nom_projet}
											</h3>
											<p 
												class="text-sm line-clamp-3"
												style="font-family: 'Space Grotesk', sans-serif;"
											>
												{projet.description}
											</p>
										</div>
									</div>
								</a>
							</div>
						))}
					</div>
				</div>

				<!-- Navigation buttons -->
				<button 
					id="carousel-prev" 
					class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-4 bg-white border-4 border-black rounded-full p-3 hover:bg-gray-100 transition-colors z-10"
					aria-label="Previous project"
				>
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<polyline points="15 18 9 12 15 6"></polyline>
					</svg>
				</button>
				<button 
					id="carousel-next" 
					class="absolute right-0 top-1/2 -translate-y-1/2 translate-x-4 bg-white border-4 border-black rounded-full p-3 hover:bg-gray-100 transition-colors z-10"
					aria-label="Next project"
				>
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<polyline points="9 18 15 12 9 6"></polyline>
					</svg>
				</button>
			</div>

			<!-- Call to action -->
			<div class="flex justify-center mt-12">
				<SkewButton href="/projets">
					<div class="flex items-center gap-3">
						<Image
							src={arrow || "/placeholder.svg"}
							alt=""
							class="w-6 h-6"
						/>
						<span>Voir tous les projets</span>
					</div>
				</SkewButton>
			</div>
		</section>

		<!-- Contact section directly in index instead of separate component -->
		<section class="container mx-auto px-6 py-16">
			<SectionTitle text="Me contacter" />

			<div class="flex justify-between items-start mt-8">
				<!-- Left side: text and CTA -->
				<div class="space-y-6">
					<!-- Applied Space Grotesk, 20px for body text -->
					<p
						style="font-family: 'Space Grotesk', sans-serif; font-size: 20px; font-weight: 400; font-style: normal; line-height: normal; color: #000;"
					>
						Intéressé par mon travail, des questions, une offre
						d'emploi...{" "}
						<span class="text-purple-600 font-semibold"
							>Contacter moi !</span
						>
					</p>

					<!-- Updated link to point to /contact page -->
					<SkewButton href="/contact">
						<div class="flex items-center gap-3">
							<Image
								src={arrow || "/placeholder.svg"}
								alt=""
								class="w-6 h-6"
							/>
							<span>Accéder au formulaire</span>
						</div>
					</SkewButton>
				</div>

				<!-- Added negative margin to move spike up -->
				<div class="-mt-16">
					<Image
						src={spike || "/placeholder.svg"}
						alt=""
						class="w-auto h-auto"
					/>
				</div>
			</div>
		</section>
	</main>
</Layout>

<script>
	// Skill descriptions object
	const skillDescriptions: Record<string, string> = {
		illustrator:
			"Adobe Illustrator est un logiciel de création graphique vectorielle professionnel, idéal pour la conception de logos, illustrations et designs complexes.",
		figma: "Figma est un outil de design d'interface collaboratif en ligne, parfait pour créer des maquettes web et mobile avec une approche en équipe.",
		css: "CSS (Cascading Style Sheets) est le langage de style qui donne vie aux pages web en définissant leur apparence visuelle et leur mise en page.",
		wordpress:
			"WordPress est un système de gestion de contenu puissant qui permet de créer et gérer facilement des sites web dynamiques sans connaissances techniques approfondies.",
		daisyui:
			"DaisyUI est une bibliothèque de composants pour Tailwind CSS qui propose des éléments d'interface prêts à l'emploi avec un design moderne et cohérent.",
		astro: "Astro est un framework web moderne qui permet de créer des sites ultra-rapides en générant du HTML statique et en chargeant le JavaScript uniquement quand nécessaire.",
		html: "HTML (HyperText Markup Language) est le langage de balisage fondamental qui structure le contenu des pages web et définit leur architecture.",
		javascript:
			"JavaScript est le langage de programmation qui rend les pages web interactives et dynamiques, permettant de créer des expériences utilisateur riches.",
		sql: "SQL (Structured Query Language) est le langage standard pour gérer et interroger les bases de données relationnelles de manière efficace.",
		davinci:
			"DaVinci Resolve est un logiciel de montage vidéo professionnel qui combine édition, étalonnage colorimétrique et effets visuels dans une seule application.",
		capcut: "CapCut est une application de montage vidéo intuitive et accessible, parfaite pour créer du contenu créatif pour les réseaux sociaux rapidement.",
		sketchbook:
			"Sketchbook est une application de dessin numérique intuitive offrant des outils professionnels pour l'illustration et le croquis artistique.",
		notion: "Notion est un espace de travail tout-en-un qui combine prise de notes, gestion de projets et bases de données pour organiser efficacement toutes vos informations.",
		canva: "Canva est une plateforme de design graphique accessible qui permet de créer facilement des visuels professionnels pour les réseaux sociaux et la communication.",
		pocketbase:
			"Pocketbase est une base de données backend légère et open-source qui fournit une API REST automatique et une interface d'administration intégrée.",
		tailwind:
			"Tailwind CSS est un framework CSS utility-first qui permet de construire rapidement des interfaces modernes en composant des classes utilitaires.",
	};

	// Get description element
	const descriptionElement = document.getElementById("skill-description");

	// Add click event listeners to all skill buttons
	document.querySelectorAll("[data-skill]").forEach((button) => {
		button.addEventListener("click", (e) => {
			const skillName = (e.currentTarget as HTMLElement).getAttribute(
				"data-skill",
			);
			if (skillName && descriptionElement) {
				descriptionElement.textContent =
					skillDescriptions[skillName] ||
					"Description non disponible";
			}
		});
	});
</script>

<!-- Carousel functionality script -->
<script>
	const carouselTrack = document.querySelector('.carousel-track') as HTMLElement;
	const prevButton = document.getElementById('carousel-prev');
	const nextButton = document.getElementById('carousel-next');
	const carouselItems = document.querySelectorAll('.carousel-item');
	
	let currentIndex = 0;
	const itemsToShow = 3;
	const itemWidth = 320 + 32; // width + gap
	const maxIndex = Math.max(0, carouselItems.length - itemsToShow);

	function updateCarousel() {
		const offset = -currentIndex * itemWidth;
		if (carouselTrack) {
			carouselTrack.style.transform = `translateX(${offset}px)`;
		}
	}

	prevButton?.addEventListener('click', () => {
		currentIndex = Math.max(0, currentIndex - 1);
		updateCarousel();
	});

	nextButton?.addEventListener('click', () => {
		currentIndex = Math.min(maxIndex, currentIndex + 1);
		updateCarousel();
	});

	// Auto-play carousel
	setInterval(() => {
		currentIndex = currentIndex >= maxIndex ? 0 : currentIndex + 1;
		updateCarousel();
	}, 5000);
</script>
