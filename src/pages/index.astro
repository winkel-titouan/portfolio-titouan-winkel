---
import Layout from "../layouts/Layout.astro";
import CompetencesSection from "../components/SkillsCloud.astro";
import SectionTitle from "../components/SectionTitle.astro";
import SkillsCloud from "../components/SkillsCloud.astro";
import SkewButton from "../components/SkewButton.astro";
import { Image } from "astro:assets";
import heroPC from "../assets/hero-pc.svg";
import personnage from "../assets/a_propos/personnage.svg";
import bubble from "../assets/bubble.svg";
import competencesBg from "../assets/competences-bg.svg";
import spike from "../assets/spike.svg";
import arrow from "../assets/arrow.svg";
import download from "../assets/boutons/download.svg";
import { pb } from "../utils/pb";

let projets = [];
try {
	const records = await pb.collection("projets").getFullList();
	projets = records;
} catch (error) {
	console.error("Erreur lors de la récupération des projets:", error);
}

function getImageUrl(projet, filename) {
	return `https://portfolio.titouan-winkel.fr/api/files/projets/${projet.id}/${filename}`;
}

function getFirstInspirationImage(projet) {
	if (projet.inspirations && projet.inspirations.length > 0) {
		return getImageUrl(projet, projet.inspirations[0]);
	}
	return "/placeholder.svg?height=300&width=400";
}

function getLogoUrl(projet) {
	if (projet.logo_new) {
		return getImageUrl(projet, projet.logo_new);
	}
	return "/placeholder.svg?height=100&width=100";
}
---

<Layout title="Titouan Winkel - Designer web">
	<!-- Added overflow-x-hidden to prevent horizontal scrolling -->
	<main class="overflow-x-hidden">
		<!-- Redesigned hero section with text and two buttons -->
		<!-- Added flex and items-center to vertically center content, reduced py padding -->
		<section
			class="relative overflow-hidden flex items-center min-h-[70vh]"
		>
			<!-- Hero background image - positioned absolutely to right edge, outside container -->

			<div class="container mx-auto px-4 md:px-6">
				<div
					class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-12 items-center"
				>
					<div class="space-y-6 md:space-y-8">
						<h1
							class="text-3xl md:text-5xl lg:text-6xl"
							style="font-family: 'Russo One', sans-serif; font-weight: 400; font-style: normal; line-height: 1.2; color: #000;"
						>
							Chaque projet est une nouvelle aventure.
						</h1>

						<div class="flex flex-col gap-4 md:gap-6">
							<SkewButton href="/projets">
								<div class="flex items-center gap-3">
									<Image
										src={arrow || "/placeholder.svg"}
										alt=""
										class="w-5 h-5 md:w-6 md:h-6"
									/>
									<span class="text-sm md:text-base"
										>Découvrir tous mes projets</span
									>
								</div>
							</SkewButton>

							<SkewButton href="#">
								<div class="flex items-center gap-3">
									<Image
										src={download || "/placeholder.svg"}
										alt=""
										class="w-5 h-5 md:w-6 md:h-6"
									/>
									<span class="text-sm md:text-base"
										>Télécharger mon CV</span
									>
								</div>
							</SkewButton>
						</div>
					</div>

					<div
						class="flex items-center justify-center min-h-[200px] md:min-h-[300px]"
					>
						<Image
							src={heroPC || "/placeholder.svg"}
							alt="Hero computer illustration"
							class="w-3/4 md:w-full h-auto max-w-full"
						/>
					</div>
				</div>
			</div>
		</section>

		<section class="container mx-auto px-4 md:px-6 py-8 md:py-16 md:ml-20">
			<SectionTitle text="Qui suis-je ?" />

			<div
				class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-12 items-start"
			>
				<div
					class="space-y-4 text-base md:text-xl"
					style="font-family: 'Space Grotesk', sans-serif; font-weight: 400; font-style: normal; line-height: normal; color: #000;"
				>
					<p>
						Je m'appelle Titouan <span
							class="text-purple-600 font-semibold">Winkel</span
						>, actuellement étudiant en deuxième année de <span
							class="text-purple-600 font-semibold"
							>BUT Métiers du Multimédia et de l'Internet</span
						>. Passionné par la création visuelle et la
						communication digitale, je me spécialise en design
						graphique. J'aime concevoir des identités visuelles, des
						supports de communication et des interfaces alliant
						créativité et clarté.
					</p>

					<p>
						Curieux et motivé, je cherche à enrichir mes compétences
						à travers des projets concrets, collaboratifs et
						innovants. Mon objectif est de mettre le design au
						service <span class="text-purple-600 font-semibold"
							>d'expériences visuelles cohérentes et impactantes</span
						>.
					</p>
				</div>

				<div class="flex items-center justify-center relative">
					<Image
						src={bubble || "/placeholder.svg"}
						alt=""
						class="absolute -z-10 w-64 md:w-96 h-64 md:h-96 opacity-50"
						style="left: 50%; top: 50%; transform: translate(-50%, -50%);"
					/>
					<Image
						src={personnage || "/placeholder.svg"}
						alt="Personnage illustration"
						class="w-auto h-48 md:h-80 relative z-10"
					/>
				</div>
			</div>
		</section>

		<!-- Added overflow-x-hidden to contain competences section -->
		<section class="py-8 md:py-16 overflow-x-hidden">
			<div class="container mx-auto px-4 md:px-6 md:ml-20 mb-15">
				<SectionTitle text="Compétences" />
			</div>

			<div
				class="flex flex-col lg:flex-row gap-6 lg:gap-10 items-start mt-5 px-4 md:px-0"
			>
				<!-- Added max-w-full to prevent overflow -->
				<div
					class="space-y-4 w-full lg:w-[420px] lg:flex-shrink-0 max-w-full"
				>
					<div class="relative w-fit">
						<Image
							src={competencesBg || "/placeholder.svg"}
							alt=""
							class="w-auto h-auto"
						/>
						<span
							class="absolute inset-0 flex items-center px-4 md:px-8 text-white text-sm md:text-lg mb-4"
							style="font-family: 'Russo One', sans-serif;"
						>
							Design
						</span>
					</div>
					<div class="relative w-fit">
						<Image
							src={competencesBg || "/placeholder.svg"}
							alt=""
							class="w-auto h-auto"
						/>
						<span
							class="absolute inset-0 flex items-center px-4 md:px-8 text-white text-sm md:text-lg mb-4"
							style="font-family: 'Russo One', sans-serif;"
						>
							Développement web
						</span>
					</div>
					<div class="relative w-fit">
						<Image
							src={competencesBg || "/placeholder.svg"}
							alt=""
							class="w-auto h-auto"
						/>
						<span
							class="absolute inset-0 flex items-center px-4 md:px-8 text-white text-sm md:text-lg mb-4"
							style="font-family: 'Russo One', sans-serif;"
						>
							Communication
						</span>
					</div>
					<div class="relative w-fit">
						<Image
							src={competencesBg || "/placeholder.svg"}
							alt=""
							class="w-auto h-auto"
						/>
						<span
							class="absolute inset-0 flex items-center px-4 md:px-8 text-white text-sm md:text-lg mb-4"
							style="font-family: 'Russo One', sans-serif;"
						>
							Audiovisuel
						</span>
					</div>
				</div>

				<!-- Fixed scale-75 to prevent overflow with proper origin -->
				<div
					class="w-full lg:w-[350px] lg:flex-shrink-0 mt-0 lg:mt-8 scale-75 md:scale-100 origin-center md:origin-left"
				>
					<SkillsCloud />
				</div>

				<div
					class="pt-4 lg:pt-8 lg:pl-4 w-full lg:w-[350px] lg:flex-shrink-0 md:ml-22"
				>
					<h3
						class="mb-4 text-xl md:text-3xl"
						style="font-family: 'Russo One', sans-serif; font-weight: 400; font-style: normal; line-height: normal; color: #000;"
					>
						Description :
					</h3>
					<p
						id="skill-description"
						class="text-justify leading-relaxed text-sm md:text-xl"
						style="font-family: 'Space Grotesk', sans-serif; font-weight: 400; font-style: normal; color: #000;"
					>
						Cliquez sur une icone
					</p>
				</div>
			</div>
		</section>

		<!-- Added projects carousel section with responsive styling -->
		<section class="container mx-auto px-4 md:px-6 py-8 md:py-16">
			<div class="md:ml-20">
				<SectionTitle text="Mes projets" />
			</div>
			<div class="relative mt-8 md:mt-12">
				<div class="carousel-container overflow-hidden">
					<div
						class="carousel-track flex gap-4 md:gap-8 transition-transform duration-500 ease-in-out"
					>
						{
							projets.map((projet) => (
								<div class="carousel-item flex-shrink-0 w-64 md:w-80">
									<a
										href={`/projets/${projet.id}`}
										class="block group"
									>
										<div class="relative bg-white border-4 border-black rounded-lg overflow-hidden hover:shadow-2xl transition-shadow duration-300">
											<div class="relative h-36 md:h-48 overflow-hidden">
												<img
													src={
														getFirstInspirationImage(
															projet,
														) || "/placeholder.svg"
													}
													alt={projet.nom_projet}
													class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"
												/>
												<div class="absolute top-2 left-2 md:top-4 md:left-4 bg-white border-2 border-black rounded-lg p-1 md:p-2">
													<img
														src={
															getLogoUrl(
																projet,
															) ||
															"/placeholder.svg" ||
															"/placeholder.svg" ||
															"/placeholder.svg"
														}
														alt={`${projet.nom_projet} logo`}
														class="w-8 h-8 md:w-12 md:h-12 object-contain"
													/>
												</div>
											</div>

											<div class="p-4 md:p-6">
												<h3
													class="text-lg md:text-xl mb-2"
													style="font-family: 'Russo One', sans-serif;"
												>
													{projet.nom_projet}
												</h3>
												<p
													class="text-xs md:text-sm line-clamp-3"
													style="font-family: 'Space Grotesk', sans-serif;"
												>
													{projet.description}
												</p>
											</div>
										</div>
									</a>
								</div>
							))
						}
					</div>
				</div>

				<button
					id="carousel-prev"
					class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-2 md:-translate-x-4 bg-white border-2 md:border-4 border-black rounded-full p-2 md:p-3 hover:bg-gray-100 transition-colors z-10"
					aria-label="Previous project"
				>
					<svg
						xmlns="http://www.w3.org/2000/svg"
						width="20"
						height="20"
						viewBox="0 0 24 24"
						fill="none"
						stroke="currentColor"
						stroke-width="2"
						class="md:w-6 md:h-6"
					>
						<polyline points="15 18 9 12 15 6"></polyline>
					</svg>
				</button>
				<button
					id="carousel-next"
					class="absolute right-0 top-1/2 -translate-y-1/2 translate-x-2 md:translate-x-4 bg-white border-2 md:border-4 border-black rounded-full p-2 md:p-3 hover:bg-gray-100 transition-colors z-10"
					aria-label="Next project"
				>
					<svg
						xmlns="http://www.w3.org/2000/svg"
						width="20"
						height="20"
						viewBox="0 0 24 24"
						fill="none"
						stroke="currentColor"
						stroke-width="2"
						class="md:w-6 md:h-6"
					>
						<polyline points="9 18 15 12 9 6"></polyline>
					</svg>
				</button>
			</div>

			<div class="flex md:ml-20 mt-8 md:mt-12">
				<SkewButton href="/projets">
					<div class="flex items-center gap-3">
						<Image
							src={arrow || "/placeholder.svg"}
							alt=""
							class="w-6 h-6"
						/>
						<span class="text-sm md:text-base"
							>Voir tous les projets</span
						>
					</div>
				</SkewButton>
			</div>
		</section>

		<section class="container mx-auto px-4 md:px-6 py-8 md:py-16 md:ml-20">
			<SectionTitle text="Me contacter" />

			<div
				class="flex flex-col md:flex-row justify-between items-start gap-6 md:gap-0 mt-8"
			>
				<div class="space-y-6">
					<p
						class="text-base md:text-xl"
						style="font-family: 'Space Grotesk', sans-serif; font-weight: 400; font-style: normal; line-height: normal; color: #000;"
					>
						Intéressé par mon travail, des questions, une offre
						d'emploi... <span class="text-purple-600 font-semibold"
							>Contacter moi !</span
						>
					</p>
					<div class="md:mt-15">
						<SkewButton href="/contact">
							<div class="flex items-center gap-3">
								<Image
									src={arrow || "/placeholder.svg"}
									alt=""
									class="w-6 h-6"
								/>
								<span class="text-sm md:text-base"
									>Accéder au formulaire</span
								>
							</div>
						</SkewButton>
					</div>
				</div>

				<div class="hidden md:block md:-mt-16 md:mr-25">
					<Image
						src={spike || "/placeholder.svg"}
						alt=""
						class="w-auto h-auto"
					/>
				</div>
			</div>
		</section>
	</main>
</Layout>

<script>
	const skillDescriptions = {
		illustrator:
			"Adobe Illustrator est un logiciel de création graphique vectorielle professionnel, idéal pour la conception de logos, illustrations et designs complexes.",
		figma: "Figma est un outil de design d'interface collaboratif en ligne, parfait pour créer des maquettes web et mobile avec une approche en équipe.",
		css: "CSS (Cascading Style Sheets) est le langage de style qui donne vie aux pages web en définissant leur apparence visuelle et leur mise en page.",
		wordpress:
			"WordPress est un système de gestion de contenu puissant qui permet de créer et gérer facilement des sites web dynamiques sans connaissances techniques approfondies.",
		daisyui:
			"DaisyUI est une bibliothèque de composants pour Tailwind CSS qui propose des éléments d'interface prêts à l'emploi avec un design moderne et cohérent.",
		astro: "Astro est un framework web moderne qui permet de créer des sites ultra-rapides en générant du HTML statique et en chargeant le JavaScript uniquement quand nécessaire.",
		html: "HTML (HyperText Markup Language) est le langage de balisage fondamental qui structure le contenu des pages web et définit leur architecture.",
		javascript:
			"JavaScript est le langage de programmation qui rend les pages web interactives et dynamiques, permettant de créer des expériences utilisateur riches.",
		sql: "SQL (Structured Query Language) est le langage standard pour gérer et interroger les bases de données relationnelles de manière efficace.",
		davinci:
			"DaVinci Resolve est un logiciel de montage vidéo professionnel qui combine édition, étalonnage colorimétrique et effets visuels dans une seule application.",
		capcut: "CapCut est une application de montage vidéo intuitive et accessible, parfaite pour créer du contenu créatif pour les réseaux sociaux rapidement.",
		sketchbook:
			"Sketchbook est une application de dessin numérique intuitive offrant des outils professionnels pour l'illustration et le croquis artistique.",
		notion: "Notion est un espace de travail tout-en-un qui combine prise de notes, gestion de projets et bases de données pour organiser efficacement toutes vos informations.",
		canva: "Canva est une plateforme de design graphique accessible qui permet de créer facilement des visuels professionnels pour les réseaux sociaux et la communication.",
		pocketbase:
			"Pocketbase est une base de données backend légère et open-source qui fournit une API REST automatique et une interface d'administration intégrée.",
		tailwind:
			"Tailwind CSS est un framework CSS utility-first qui permet de construire rapidement des interfaces modernes en composant des classes utilitaires.",
	};

	const descriptionElement = document.getElementById("skill-description");

	document.querySelectorAll("[data-skill]").forEach((button) => {
		button.addEventListener("click", (e) => {
			const skillName = (e.currentTarget as HTMLElement).getAttribute(
				"data-skill",
			);
			if (skillName && descriptionElement) {
				descriptionElement.textContent =
					skillDescriptions[skillName] ||
					"Description non disponible";
			}
		});
	});

	// Added carousel functionality script
	const carouselTrack = document.querySelector(
		".carousel-track",
	) as HTMLElement;
	const prevButton = document.getElementById("carousel-prev");
	const nextButton = document.getElementById("carousel-next");
	const carouselItems = document.querySelectorAll(".carousel-item");

	let currentIndex = 0;
	const itemsToShow = window.innerWidth < 768 ? 1 : 3;
	const itemWidth = window.innerWidth < 768 ? 256 + 16 : 320 + 32;
	const maxIndex = Math.max(0, carouselItems.length - itemsToShow);

	function updateCarousel() {
		const offset = -currentIndex * itemWidth;
		if (carouselTrack) {
			carouselTrack.style.transform = `translateX(${offset}px)`;
		}
	}

	prevButton?.addEventListener("click", () => {
		currentIndex = Math.max(0, currentIndex - 1);
		updateCarousel();
	});

	nextButton?.addEventListener("click", () => {
		currentIndex = Math.min(maxIndex, currentIndex + 1);
		updateCarousel();
	});

	setInterval(() => {
		currentIndex = currentIndex >= maxIndex ? 0 : currentIndex + 1;
		updateCarousel();
	}, 5000);
</script>
