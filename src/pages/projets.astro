---
import Layout from '../layouts/Layout.astro';
import SkewButton from '../components/SkewButton.astro';
import pb, { type Projet } from '../utils/pb.ts';
import line1 from '../assets/boutons/line1.svg';
import line2 from '../assets/boutons/line2.svg';
import bubble from '../assets/bubble.svg';

let projets: Projet[] = [];

try {
  const records = await pb.collection('projets').getFullList<Projet>();
  projets = records;
} catch (error) {
  console.error('Erreur lors de la récupération des projets:', error);
}

function getImageUrl(projet: Projet): string {
  if (projet.prod_finale && projet.prod_finale.length > 0) {
    return `https://portfolio.titouan-winkel.fr/api/files/projets/${projet.id}/${projet.prod_finale[0]}`;
  }
  return '/placeholder.svg?height=400&width=300';
}
---

<Layout title="Mes Projets - Titouan Winkel">
  <main class="min-h-screen bg-[#E8E3F5] pt-32 pb-20">
    <!-- Section titre avec bulles -->
    <section class="relative max-w-7xl mx-auto px-8 mb-32">
      <!-- Bulles en arrière-plan -->
      <div class="absolute top-1/2 left-1/4 -translate-y-1/2 -translate-x-1/2 z-0">
        <img src={bubble.src || "/placeholder.svg"} alt="" class="w-48 h-48 opacity-60" />
      </div>
      <div class="absolute top-1/4 left-1/3 -translate-y-1/2 z-0">
        <img src={bubble.src || "/placeholder.svg"} alt="" class="w-32 h-32 opacity-40" />
      </div>
      <div class="absolute top-3/4 left-1/5 -translate-y-1/2 z-0">
        <img src={bubble.src || "/placeholder.svg"} alt="" class="w-40 h-40 opacity-50" />
      </div>

      <!-- Titre avec décorations -->
      <div class="relative z-10 inline-block">
        <img src={line1.src || "/placeholder.svg"} alt="" class="absolute -top-2 -left-4 w-12 h-12" />
        <h1 class="text-black font-[Russo_One] text-[50px] font-normal leading-normal italic">
          Mes projets,
        </h1>
        <img src={line2.src || "/placeholder.svg"} alt="" class="absolute -bottom-2 -right-4 w-12 h-12" />
      </div>

      <!-- Flèche vers le bas -->
      <div class="flex justify-center mt-16">
        <svg width="24" height="40" viewBox="0 0 24 40" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 0V36M12 36L4 28M12 36L20 28" stroke="black" stroke-width="3"/>
        </svg>
      </div>
    </section>

    <!-- Liste des projets -->
    <section class="max-w-7xl mx-auto px-8 space-y-32">
      {projets.map((projet, index) => (
        <article class="relative flex items-center gap-8" style={`flex-direction: ${index % 2 === 0 ? 'row' : 'row-reverse'}`}>
          <!-- Forme colorée avec la couleur du projet -->
          <div 
            class="w-96 h-96 flex-shrink-0"
            style={`background: ${projet.couleur}; transform: skewY(-5deg);`}
          />

          <!-- Contenu du projet -->
          <div class="flex-1 space-y-6">
            <div class="flex items-center gap-4">
              <h2 class="text-black font-[Russo_One] text-[40px] font-normal leading-normal italic">
                {projet.nom_projet}
              </h2>
              <!-- Les icônes de compétences seront ajoutées plus tard -->
            </div>

            <p class="text-black font-[Space_Grotesk] text-[20px] font-normal leading-normal max-w-md">
              {projet.description}
            </p>

            <SkewButton href={`/projets/${projet.id}`}>
              Voir plus
            </SkewButton>
          </div>

          <!-- Image du projet (mockup incliné) -->
          <div class="flex-shrink-0" style="transform: rotate(-8deg);">
            <div class="relative w-80 h-[500px] rounded-[40px] overflow-hidden border-8 border-black shadow-2xl">
              <img 
                src={getImageUrl(projet) || "/placeholder.svg"} 
                alt={projet.nom_projet}
                class="w-full h-full object-cover"
              />
            </div>
          </div>
        </article>
      ))}
    </section>
  </main>
</Layout>
